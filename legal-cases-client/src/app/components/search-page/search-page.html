<div class="search-page">
  <div class="hero-section">
    <div class="hero-container">
      <div class="hero-title">
        <mat-icon>search</mat-icon>
        <h1>חיפוש בפסק דין</h1>
      </div>
      <p class="hero-subtitle">חיפוש מילים וביטויים בתוך פסק דין ספציפי</p>
    </div>
  </div>

  <div class="content-section">
    <div class="container">
      <!-- Search Form -->
      <div class="form-section">
        <h2 class="section-title">
          <mat-icon>search</mat-icon>
          הגדרות חיפוש
        </h2>

        <div class="form-field-wrapper full-width">
          <label class="field-label">מזהה פסק דין *</label>
          <input
            type="number"
            class="custom-input"
            [(ngModel)]="decisionId"
            placeholder="לדוגמה: 5"
          />
        </div>

        <!-- Search Type Toggle -->
        <div class="search-type-toggle">
          <button mat-raised-button
                  [color]="searchType === 'word' ? 'primary' : ''"
                  (click)="searchType = 'word'">
            <mat-icon>label</mat-icon>
            חיפוש מילה
          </button>
          <button mat-raised-button
                  [color]="searchType === 'phrase' ? 'primary' : ''"
                  (click)="searchType = 'phrase'">
            <mat-icon>notes</mat-icon>
            חיפוש ביטוי
          </button>
        </div>

        <div class="form-field-wrapper full-width">
          <label class="field-label">{{ searchType === 'word' ? 'הזן מילה' : 'הזן ביטוי' }}</label>
          <input
            type="text"
            class="custom-input"
            [(ngModel)]="searchQuery"
            (keyup.enter)="performSearch()"
            [placeholder]="searchType === 'word' ? 'לדוגמה: נזק' : 'לדוגמה: מניעת חוסר צדק'"
          />
        </div>

        <!-- Advanced Options -->
        <div class="advanced-options">
          <h3 style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">אפשרויות מתקדמות</h3>
          <div class="form-row">
            <div class="form-field-wrapper">
              <label class="field-label">שורות לפני</label>
              <input
                type="number"
                class="custom-input"
                [(ngModel)]="beforeLines"
                min="0"
                max="10"
              />
            </div>

            <div class="form-field-wrapper">
              <label class="field-label">שורות אחרי</label>
              <input
                type="number"
                class="custom-input"
                [(ngModel)]="afterLines"
                min="0"
                max="10"
              />
            </div>

            <div class="form-field-wrapper">
              <label class="field-label">מקסימום תוצאות</label>
              <input
                type="number"
                class="custom-input"
                [(ngModel)]="maxResults"
                min="1"
                max="1000"
              />
            </div>
          </div>
        </div>

        <div *ngIf="error" class="alert alert-error">
          <mat-icon>error_outline</mat-icon>
          <div>
            <strong>שגיאה בחיפוש</strong>
            <p>{{ error }}</p>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="performSearch()" [disabled]="loading || !decisionId || !searchQuery">
            <mat-icon *ngIf="!loading">search</mat-icon>
            <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
            {{ loading ? 'מחפש...' : 'חפש' }}
          </button>
          <button mat-button (click)="clearSearch()" [disabled]="loading">
            <mat-icon>clear</mat-icon>
            נקה
          </button>
        </div>
      </div>

      <!-- Results -->
      <div *ngIf="searchResults && !loading" class="form-section">
        <h2 class="section-title">
          <mat-icon>list</mat-icon>
          תוצאות חיפוש
        </h2>

        <p style="margin-bottom: 20px; color: var(--text-primary); font-size: 14px;">
          נמצאו <strong>{{ searchResults.occurrences.length || 0 }}</strong> מופעים
          של {{ searchType === 'word' ? 'המילה' : 'הביטוי' }}
          "<strong>{{ getSearchTerm() }}</strong>"
        </p>

        <div *ngIf="searchResults.occurrences.length === 0" class="empty-state">
          <mat-icon>search_off</mat-icon>
          <h3>לא נמצאו תוצאות</h3>
          <p>נסה לשנות את מונחי החיפוש או את הפרמטרים</p>
        </div>

        <div *ngFor="let occurrence of searchResults.occurrences; let i = index" class="result-item">
          <div class="result-header">
            <span class="result-number">#{{ i + 1 }}</span>
            <span class="result-location">שורה {{ occurrence.line_no }} • תווים {{ occurrence.char_start }}-{{ occurrence.char_end }}</span>
          </div>
          <div class="result-context">
            <div *ngFor="let line of occurrence.context" class="context-line"
                 [class.highlight-line]="line.line === occurrence.line_no">
              <span class="line-number">{{ line.line }}:</span>
              <span class="line-text">{{ line.text }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
