<div class="groups-page">
  <div class="hero-section">
    <div class="hero-container">
      <div class="hero-title">
        <mat-icon>category</mat-icon>
        <h1>קבוצות מונחים משפטיים</h1>
      </div>
      <p class="hero-subtitle">יצירה וניהול של קבוצות מילים לחיפוש ואינדוקס</p>
    </div>
  </div>

  <div class="content-section">
    <div class="container">
      <!-- Step 1: Create Group -->
      <div class="form-section">
        <h2 class="section-title">
          <mat-icon>add_circle</mat-icon>
          שלב 1: יצירת קבוצת מילים
        </h2>

        <div class="form-field-wrapper full-width">
          <label class="field-label">שם הקבוצה *</label>
          <input
            type="text"
            class="custom-input"
            [(ngModel)]="groupName"
            placeholder="לדוגמה: מונחי נזיקין"
          />
        </div>

        <div class="form-field-wrapper full-width">
          <label class="field-label">תיאור</label>
          <textarea
            class="custom-input"
            [(ngModel)]="groupDescription"
            rows="3"
            placeholder="תיאור אופציונלי לקבוצה"
          ></textarea>
        </div>

        <div *ngIf="createSuccess" class="alert alert-success">
          <mat-icon>check_circle</mat-icon>
          <div>
            <strong>קבוצה נוצרה בהצלחה!</strong>
            <p>מזהה קבוצה: {{ createdGroupId }}</p>
          </div>
        </div>

        <div *ngIf="createError" class="alert alert-error">
          <mat-icon>error_outline</mat-icon>
          <div>
            <strong>שגיאה ביצירת קבוצה</strong>
            <p>{{ createError }}</p>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="createGroup()" [disabled]="creatingGroup || !groupName.trim()">
            <mat-icon *ngIf="!creatingGroup">add</mat-icon>
            <mat-spinner diameter="20" *ngIf="creatingGroup"></mat-spinner>
            {{ creatingGroup ? 'יוצר...' : 'צור קבוצה' }}
          </button>
          <button mat-button (click)="resetCreateForm()" [disabled]="creatingGroup">
            <mat-icon>refresh</mat-icon>
            אפס
          </button>
        </div>
      </div>

      <!-- Step 2: Add Words -->
      <div class="form-section">
        <h2 class="section-title">
          <mat-icon>library_add</mat-icon>
          שלב 2: הוספת מילים לקבוצה
        </h2>

        <div *ngIf="!createdGroupId" class="alert alert-warning">
          <mat-icon>info</mat-icon>
          <div>
            <strong>שים לב</strong>
            <p>צור קבוצה תחילה בשלב 1</p>
          </div>
        </div>

        <div *ngIf="createdGroupId">
          <div class="alert alert-success" style="margin-bottom: 20px;">
            <mat-icon>check</mat-icon>
            <div>
              <strong>מוכן להוספת מילים</strong>
              <p>מוסיף מילים לקבוצה מזהה: {{ createdGroupId }}</p>
            </div>
          </div>

          <div class="form-field-wrapper full-width">
            <label class="field-label">מילים (מופרדות בפסיקים)</label>
            <textarea
              class="custom-input"
              [(ngModel)]="wordsInput"
              rows="4"
              placeholder="לדוגמה: נזק, פיצוי, אחריות, רשלנות"
            ></textarea>
            <small>הזן מילים מופרדות בפסיק לצורך הוספה לקבוצה</small>
          </div>

          <div *ngIf="addWordsSuccess" class="alert alert-success">
            <mat-icon>check_circle</mat-icon>
            <div>
              <strong>הוספה הושלמה!</strong>
              <p>נוספו {{ addedCount }} מילים בהצלחה</p>
            </div>
          </div>

          <div *ngIf="addWordsError" class="alert alert-error">
            <mat-icon>error_outline</mat-icon>
            <div>
              <strong>שגיאה בהוספת מילים</strong>
              <p>{{ addWordsError }}</p>
            </div>
          </div>

          <div class="form-actions">
            <button mat-raised-button color="primary" (click)="addWordsToGroup()" [disabled]="addingWords || !wordsInput.trim()">
              <mat-icon *ngIf="!addingWords">add</mat-icon>
              <mat-spinner diameter="20" *ngIf="addingWords"></mat-spinner>
              {{ addingWords ? 'מוסיף...' : 'הוסף מילים' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Step 3: View Index -->
      <div class="form-section">
        <h2 class="section-title">
          <mat-icon>list</mat-icon>
          שלב 3: צפייה באינדקס קבוצה
        </h2>

        <p style="margin-bottom: 20px; color: var(--text-secondary);">הזן מזהה קבוצה ומזהה החלטה כדי לצפות באינדקס המילים עם דוגמאות מהטקסט</p>

        <div class="form-row">
          <div class="form-field-wrapper">
            <label class="field-label">מזהה קבוצה</label>
            <input
              type="number"
              class="custom-input"
              [(ngModel)]="viewGroupId"
              placeholder="לדוגמה: 1"
            />
          </div>

          <div class="form-field-wrapper">
            <label class="field-label">מזהה החלטה</label>
            <input
              type="number"
              class="custom-input"
              [(ngModel)]="viewDecisionId"
              placeholder="לדוגמה: 5"
            />
          </div>
        </div>

        <div *ngIf="indexError" class="alert alert-error">
          <mat-icon>error_outline</mat-icon>
          <div>
            <strong>שגיאה בטעינת אינדקס</strong>
            <p>{{ indexError }}</p>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="loadGroupIndex()" [disabled]="loadingIndex || !viewGroupId || !viewDecisionId">
            <mat-icon *ngIf="!loadingIndex">search</mat-icon>
            <mat-spinner diameter="20" *ngIf="loadingIndex"></mat-spinner>
            {{ loadingIndex ? 'טוען...' : 'טען אינדקס' }}
          </button>
        </div>

        <!-- Index Results -->
        <div *ngIf="wordGroupIndex && !loadingIndex" class="index-results">
          <h3 style="margin: 24px 0 16px; color: var(--text-primary);">
            אינדקס קבוצה {{ wordGroupIndex.group_id }} בהחלטה {{ wordGroupIndex.decision_id }}
          </h3>

          <div *ngIf="wordGroupIndex.words.length === 0" class="empty-state">
            <mat-icon>info</mat-icon>
            <h3>לא נמצאו תוצאות</h3>
            <p>לא נמצאו מילים מהקבוצה בהחלטה זו</p>
          </div>

          <div *ngFor="let wordData of wordGroupIndex.words" class="word-result">
            <h4 style="display: flex; align-items: center; gap: 8px; margin: 20px 0 12px; color: var(--google-blue);">
              <mat-icon>label</mat-icon>
              {{ wordData.word }} ({{ wordData.samples.length }} דוגמאות)
            </h4>

            <div *ngFor="let sample of wordData.samples; let i = index" class="sample-item">
              <div class="sample-header">
                <strong>דוגמה #{{ i + 1 }}</strong>
                <span>שורה {{ sample.line_no }}, תווים {{ sample.char_start }}-{{ sample.char_end }}</span>
              </div>
              <div class="sample-context">
                <div *ngFor="let line of sample.context" class="context-line">
                  <span class="line-number">{{ line.line }}:</span>
                  <span class="line-text">{{ line.text }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
